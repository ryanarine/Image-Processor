{"version":3,"sources":["ToolFunctions.js","Reducers/imageReducer.js","utils.js","Reducers/replaceReducer.js","Reducers/rootReducer.js","Actions/toolActions.js","Actions/replaceActions.js","Options.js","Constants.js","Find.js","Replace.js","Tolerance.js","ReplaceTool.js","Tools.js","Lighten.js","SimpleTools.js","Upload.js","Download.js","App.js","index.js"],"names":["isMatch","comparisons","pixel","search","percentages","tolerance","match","totalValue","slice","reduce","sum","val","values","map","index","offset","Math","abs","alert","operate","operators","data","initialState","imgData","newData","x1","x2","y1","y2","pixelSample","colourSample","zoom1","zoom2","mapEffectToFunction","GRAYSCALE","avg","i","length","round","NEGATIVE","BRIGHT","mult","REPLACE","oldVal","newVal","smallestSize","zoomRatio","boundary","point","canvas","imgWidth","imgHeight","width","height","redraw","x","y","canvasName","document","getElementById","getContext","putImageData","copy","data1","data2","forEach","changeCursor","sample","cursor","className","imageReducer","state","action","type","isNewCanvas","fileName","name","id","pageX","pageY","halfX","halfY","ratioX","scrollWidth","ratioY","scrollHeight","offsetLeft","offsetTop","centerPoint","ctx","width1","height1","width2","height2","min","Uint8ClampedArray","row","col","ImageData","effect","payload","body","style","section","Image","oldColour","adjacent","visited","Array","frontier","pop","colour","push","adj","getSection","copyToNew","imgFile","zoom","isZoomOut","newZoom","max","convertToPercentage","value","total","cc","fc","fp","oc","rc","tc","rModal","fModal","replaceReducer","startsWith","operator","isNaN","Number","toFixed","substring","isOperator","option","replace","r","g","b","a","combineReducers","image","switchSample","basicImgEffect","swap","updateInput","event","target","updateOption","updatePercentage","replaceModal","findModal","sampleColour","arrowStyle","position","borderLeft","borderRight","borderTop","top","left","animation","boxStyle","padding","backgroundColor","borderRadius","transform","Options","props","dispatch","useDispatch","modal","buttons","options","key","onClick","window","addEventListener","click","removeEventListener","Fragment","colours","fullColours","columnInitials","mapCompareToTitle","compare","isPercentage","middle","prefix","suffix","Find","isAlpha","useSelector","title","e","stopPropagation","onChange","mapOperatorToTitle","msg","Replace","percentage","button","Tolerance","ReplaceTool","getStateValues","bind","navigate","this","which","parent","findIndex","selectionStart","newName","focus","end","setTimeout","setSelectionRange","store","getState","frt","onKeyDown","autoComplete","Component","connect","Tools","Lighten","handleChange","handleClick","setState","multiplier","text","PureComponent","SimpleTools","display","gridTemplateColumns","justifyItems","ratio","Upload","change","hidden","Download","useState","anchor","setAnchor","handleClose","handleDownload","download","currentTarget","Menu","anchorEl","keepMounted","open","Boolean","onClose","MenuItem","App","imageChange","recenter","file","files","img","reader","FileReader","onload","read","imgEvent","createElement","drawImage","getImageData","setImgData","then","refresh","filedata","result","src","setFileName","lastIndexOf","readAsDataURL","link","setAttribute","toDataURL","remove","center","updatePixel","Promise","resolve","createStore","rootReducer","applyMiddleware","thunk","ReactDOM","render"],"mappings":"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","file":"static/js/main.f54a451d.chunk.js","sourcesContent":["/**\r\n * Change the data of an image\r\n * @param {Uint8ClampedArray} data - Image data\r\n * @param {Array} comparisons - Comparison operators, each one is one of [=,>,>=,<,<=]\r\n * @param {Array} oldVal - A pixel or percentage to be matched against according to comparisons\r\n * @param {Array} percentages - Boolean array indicating whether to search for absolute or relative values\r\n * @param {Array} operators  - Mathematical operators, each one is one of [=,+,-,*,/]\r\n * @param {Array} newVal  - A pixel to be operated against according to operators\r\n * @param {Array} tolerance  - An rgba range\r\n */\r\nexport function changeImgData(data, comparisons, oldVal, percentages, operators, newVal, tolerance) {\r\n  for (let i = 0; i < data.length; i += 4) {\r\n    if (isMatch(comparisons, data.slice(i, i + 4), oldVal, percentages, tolerance)) {\r\n      operate(operators, data, newVal, i);\r\n    }\r\n  }\r\n}\r\n\r\n/*\r\n  -Image is an ImageData objects\r\n  -pixel ([r,g,b,a,x,y]) is a pixel in Image containing its x and y coordinate\r\n  -comparisons specify a comparison operator [=,>,>=,<,<=]\r\n  -percentages is a boolean array indicating whether to search for absolute or relative values\r\n  -tolerance is an rgba range (only used when the comparison operator is equality)\r\n  -Returns an array of pixel indices that corresponds to a section in Image originating at pixel with the given tolerance range\r\n*/\r\nexport function getSection(Image, pixel, comparisons, oldColour, percentages, tolerance) {\r\n  let [width, height, data] = [Image.width, Image.height, Image.data];\r\n  // Adjacent offsets of pixels (Up, Right, Down, Left)\r\n  let adjacent = [\r\n    [0, -1],\r\n    [1, 0],\r\n    [0, 1],\r\n    [-1, 0]\r\n  ];\r\n  // visited[i] indicates whether pixel i has been added to the frontier before\r\n  let visited = new Array(width * height);\r\n  // The array of pixels to return\r\n  let section = [];\r\n  let [x, y] = [pixel[4], pixel[5]];\r\n  // The array of pixels that need to be checked if they belong to the section\r\n  let frontier = [[x, y]];\r\n  visited[y * width + x] = true;\r\n  while (frontier.length !== 0) {\r\n    [x, y] = frontier.pop();\r\n    // Check if pixel has valid coordinates\r\n    if (x < 0 || x > width || y < 0 || y > height) {\r\n      continue;\r\n    }\r\n    // Get the colour of the pixel\r\n    let colour = [];\r\n    for (let offset = 0; offset < 4; offset++) {\r\n      colour.push(data[y * width * 4 + x * 4 + offset]);\r\n    }\r\n    // Check that the pixel colour is a match\r\n    if (isMatch(comparisons, colour, oldColour, percentages, tolerance)) {\r\n      // Add pixel to section\r\n      section.push(y * width * 4 + x * 4);\r\n      // Add adjacent pixels to frontier\r\n      // eslint-disable-next-line\r\n      adjacent.forEach(adj => {\r\n        // If they have not been added before\r\n        if (!visited[(y + adj[1]) * width + x + adj[0]]) {\r\n          visited[(y + adj[1]) * width + x + adj[0]] = true;\r\n          frontier.push([x + adj[0], y + adj[1]]);\r\n        }\r\n      });\r\n    }\r\n  }\r\n  return section;\r\n}\r\n\r\n// Grayscales the image data\r\nexport function grayscale(data) {\r\n  let avg = 0;\r\n  for (let i = 0; i < data.length; i += 4) {\r\n    avg = Math.round((data[i] + data[i + 1] + data[i + 2]) / 3);\r\n    data[i] = avg;\r\n    data[i + 1] = avg;\r\n    data[i + 2] = avg;\r\n  }\r\n}\r\n\r\n// Negates the image data\r\nexport function negative(data) {\r\n  for (let i = 0; i < data.length; i += 4) {\r\n    data[i] = 255 - data[i];\r\n    data[i + 1] = 255 - data[i + 1];\r\n    data[i + 2] = 255 - data[i + 2];\r\n  }\r\n}\r\n\r\n// Change the light intensity of the data by the given multiplier\r\nexport function lighten(data, mult) {\r\n  for (let i = 0; i < data.length; i += 4) {\r\n    data[i] = data[i] * mult;\r\n    data[i + 2] = data[i + 2] * mult;\r\n    data[i + 1] = data[i + 1] * mult;\r\n  }\r\n}\r\n\r\n// returns true if the pixel matches the search values according to the comparison option and the tolerance range\r\nfunction isMatch(comparisons, pixel, search, percentages, tolerance) {\r\n  let match = true;\r\n  let compare;\r\n  const totalValue = pixel.slice(0, 3).reduce((sum, val) => sum + val);\r\n  const values = pixel.map((val, index) => (percentages[index] ? (val / totalValue) * 100 : val));\r\n  for (let offset = 0; offset < 4; offset++) {\r\n    compare = comparisons[offset];\r\n    switch (compare) {\r\n      case \"=\":\r\n        match = match && Math.abs(values[offset] - search[offset]) <= tolerance[offset];\r\n        break;\r\n      case \">\":\r\n        match = match && values[offset] > search[offset];\r\n        break;\r\n      case \">=\":\r\n        match = match && values[offset] >= search[offset];\r\n\r\n        break;\r\n      case \"<\":\r\n        match = match && values[offset] < search[offset];\r\n        break;\r\n      case \"<=\":\r\n        match = match && values[offset] <= search[offset];\r\n        break;\r\n      default:\r\n        alert(\"Something went terribly wrong. Please refresh the page and try again\");\r\n        return;\r\n    }\r\n  }\r\n  return match;\r\n}\r\n\r\n// Change the pixel in data specified by index by applying the arithmetic operator on it and pixel2's values\r\nexport function operate(operators, data, pixel, index) {\r\n  let operator = operators;\r\n  for (let offset = 0; offset < 4; offset++) {\r\n    operator = operators[offset];\r\n    switch (operator) {\r\n      case \"=\":\r\n        data[index + offset] = pixel[offset];\r\n        break;\r\n      case \"+\":\r\n        data[index + offset] += pixel[offset];\r\n        break;\r\n      case \"-\":\r\n        data[index + offset] -= pixel[offset];\r\n        break;\r\n      case \"*\":\r\n        data[index + offset] *= pixel[offset];\r\n        break;\r\n      case \"/\":\r\n        data[index + offset] /= pixel[offset];\r\n        break;\r\n      default:\r\n        alert(\"Something went terribly wrong. Please refresh the page and try again\");\r\n        return;\r\n    }\r\n  }\r\n}\r\n","import { grayscale, negative, lighten, changeImgData, getSection, operate } from \"../ToolFunctions\";\r\n\r\nexport const initialState = {\r\n  imgData: null,\r\n  newData: null,\r\n  x1: 0,\r\n  x2: 0,\r\n  y1: 0,\r\n  y2: 0,\r\n  pixelSample: false,\r\n  colourSample: false,\r\n  pixel: null,\r\n  zoom1: 0,\r\n  zoom2: 0\r\n};\r\n\r\nconst mapEffectToFunction = { GRAYSCALE: grayscale, NEGATIVE: negative, BRIGHT: lighten, REPLACE: changeImgData };\r\nconst smallestSize = 50;\r\nconst zoomRatio = 1.5;\r\n\r\nfunction imageReducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case \"SET\":\r\n      return action.isNewCanvas ? { ...state, newData: action.data } : { ...state, imgData: action.data };\r\n    case \"NAME\":\r\n      return { ...state, fileName: action.name };\r\n    case \"REFRESH\":\r\n      return { ...state, x1: 0, x2: 0, y1: 0, y2: 0, sample: false, pixel: null, zoom1: 0, zoom2: 0 };\r\n    case \"CENTER\":\r\n      let canvas = action.canvas;\r\n      let [x, y, imgData] =\r\n        canvas.id === \"canvas\" ? [state.x1, state.y1, state.imgData] : [state.x2, state.y2, state.newData];\r\n      // Get the appropriate center point\r\n      let point = centerPoint(action.canvas, x, y, imgData.width, imgData.height, action.pageX, action.pageY);\r\n      // Recenter image if the center point has changed\r\n      if (point[0] !== x || point[1] !== y) {\r\n        let ctx = canvas.getContext(\"2d\");\r\n        // Update state\r\n        canvas.id === \"newCanvas\" ? ([state.x2, state.y2] = point) : ([state.x1, state.y1] = point);\r\n        // Construct the recentered image data\r\n        let [width1, height1] = [imgData.width, imgData.height];\r\n        let [width2, height2] = [width1 - point[0], height1 - point[1]];\r\n        // Construct only the parts we need\r\n        width2 = Math.min(canvas.width, width2);\r\n        height2 = Math.min(canvas.height, height2);\r\n        let data = new Uint8ClampedArray(width2 * height2 * 4);\r\n        // Copy the image data\r\n        for (let row = 0; row < height2; row++) {\r\n          for (let col = 0; col < width2; col++) {\r\n            for (let val = 0; val < 4; val++) {\r\n              data[row * width2 * 4 + col * 4 + val] =\r\n                imgData.data[(point[1] + row) * width1 * 4 + (point[0] + col) * 4 + val];\r\n            }\r\n          }\r\n        }\r\n        // Draw image\r\n        imgData = new ImageData(data, width2, height2);\r\n        ctx.putImageData(imgData, 0, 0);\r\n      }\r\n      return state;\r\n    case \"PIXEL\":\r\n      changeCursor(state.pixelSample);\r\n      return { ...state, pixelSample: false, pixel: action.pixel };\r\n    case \"SAMPLE\":\r\n      if (action.sample === \"PIXEL\") {\r\n        changeCursor(state.pixelSample);\r\n        return { ...state, pixelSample: !state.pixelSample, colourSample: false };\r\n      } else if (action.sample === \"COLOUR\") {\r\n        changeCursor(state.colourSample, false);\r\n        return { ...state, pixelSample: false, colourSample: !state.colourSample };\r\n      }\r\n      return state;\r\n    case \"BASIC\":\r\n      if (state.newData) {\r\n        // Get the effect\r\n        let effect = mapEffectToFunction[action.effect];\r\n        // Copy old data to new data\r\n        copy(state.imgData.data, state.newData.data);\r\n        // Apply effect and redraw\r\n        if (action.payload) {\r\n          effect(state.newData.data, ...action.payload);\r\n        } else {\r\n          effect(state.newData.data);\r\n        }\r\n        redraw(state.x2, state.y2, state.newData);\r\n      }\r\n      return state;\r\n    case \"SECTION\": {\r\n      if (state.pixel && state.newData) {\r\n        document.body.style.cursor = \"progress\";\r\n        const { comparisons, oldVal, percentages, tolerance, newVal, operators } = action;\r\n        const section = getSection(state.imgData, state.pixel, comparisons, oldVal, percentages, tolerance);\r\n        const data = state.newData.data;\r\n        copy(state.imgData.data, state.newData.data);\r\n        // Replace the colour of each pixel in the section\r\n        section.forEach(pixel => {\r\n          operate(operators, data, newVal, pixel);\r\n        });\r\n        redraw(state.x2, state.y2, state.newData);\r\n        document.body.style.cursor = \"default\";\r\n      } else if (!state.pixel) {\r\n        alert(\r\n          \"You must first specify a section to paint. Click the cursor icon and then click on an area in the left canvas.\"\r\n        );\r\n      }\r\n      return state;\r\n    }\r\n    case \"SWAP\": {\r\n      if (state.imgData) {\r\n        let [canvasName, imgFile, x, y] = action.copyToNew\r\n          ? [\"newCanvas\", state.imgData, state.x2, state.y2]\r\n          : [\"canvas\", state.newData, state.x1, state.y1];\r\n        const canvas = document.getElementById(canvasName);\r\n        const ctx = canvas.getContext(\"2d\");\r\n        ctx.putImageData(imgFile, -x, -y, x, y, canvas.width, canvas.height);\r\n        let data = new Uint8ClampedArray(imgFile.data);\r\n        let copy = new ImageData(data, imgFile.width, imgFile.height);\r\n        return action.copyToNew ? { ...state, newData: copy } : { ...state, imgData: copy };\r\n      }\r\n      return state;\r\n    }\r\n    case \"ZOOM\": {\r\n      if (state.imgData) {\r\n        let [canvasName, imgFile, zoom, x, y] = action.isNewCanvas\r\n          ? [\"newCanvas\", state.newData, state.zoom2, state.x2, state.y2]\r\n          : [\"canvas\", state.imgData, state.zoom1, state.x1, state.y1];\r\n        const canvas = document.getElementById(canvasName);\r\n        // Do nothing if the action is zooming out and the canvas completely contains the image unless user has zoomed in before\r\n        // Note: zoom < 0 is only there to maintain consistency (otherwise user might be able to zoom in but not zoom back out)\r\n        if (!action.isZoomOut || zoom < 0 || imgFile.width > canvas.scrollWidth || imgFile.height > canvas.scrollHeight) {\r\n          let newZoom = action.isZoomOut ? zoom + 1 : zoom - 1;\r\n          let mult = zoomRatio ** newZoom;\r\n          // Canvas dimensions is always square so images look appropriate\r\n          let width = Math.round(canvas.scrollWidth * mult);\r\n          // Set zoom bounds while still maintaining consistency\r\n          if ((action.isZoomOut && zoom >= 0) || (!action.isZoomOut && zoom <= 0)) {\r\n            if (!action.isZoomOut && width < smallestSize) {\r\n              width = smallestSize;\r\n            } else if (action.isZoomOut && width >= imgFile.width && width >= imgFile.height) {\r\n              width = Math.max(imgFile.width, imgFile.height);\r\n            }\r\n          }\r\n          // Redraw image if the zoom was valid\r\n          if (width !== canvas.width) {\r\n            // Set the zoom\r\n            canvas.width = canvas.height = width;\r\n            // Top-left pixel might have to change due to boundaries\r\n            [x, y] = boundary([x, y], canvas, imgFile.width, imgFile.height);\r\n            // Update state and redraw\r\n            state = action.isNewCanvas\r\n              ? { ...state, x2: x, y2: y, zoom2: newZoom }\r\n              : { ...state, x1: x, y1: y, zoom1: newZoom };\r\n            redraw(x, y, imgFile, canvasName);\r\n          }\r\n        }\r\n      }\r\n      return state;\r\n    }\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\n/*\r\n-x and y are the x and y coordinates of the top left pixel on the canvas\r\n-width and height are the width and height of the canvas image data\r\n-pageX and pageY are the x and y coordinates of the clicked point on the page if there was a clicked point\r\n-Returns the x and y coordinates of the center pixel on the canvas\r\n*/\r\nfunction centerPoint(canvas, x, y, width, height, pageX, pageY) {\r\n  let halfX = canvas.width / 2;\r\n  let halfY = canvas.height / 2;\r\n  let ratioX = canvas.width / canvas.scrollWidth;\r\n  let ratioY = canvas.height / canvas.scrollHeight;\r\n  // x/y + offsetX/offsetY - offsetLeft/offsetTop = x/y coordinate of clicked point\r\n  // Multiplied by ratioX/ratioY = x/y coordinate of clicked pixel\r\n  // Subtract by half to get the top left coordinate if clicked point was the center\r\n  let point = [\r\n    Math.round(x + (pageX - canvas.offsetLeft) * ratioX - halfX),\r\n    Math.round(y + (pageY - canvas.offsetTop) * ratioY - halfY)\r\n  ];\r\n  // Compensate for boundaries\r\n  return boundary(point, canvas, width, height);\r\n}\r\n\r\n// Translates the point if it is off the boundary specified by the canvas and its image data\r\nfunction boundary(point, canvas, imgWidth, imgHeight) {\r\n  // imgWidth - canvas.width = x-coordinate of leftmost pixels when rightmost pixels are on the boundary\r\n  // imgHeight - canvas.height = y-coordinate of topmost pixels when bottommost pixels are on the boundary\r\n  if (imgWidth < canvas.width || point[0] < 0) {\r\n    point[0] = 0;\r\n  } else {\r\n    point[0] = point[0] > imgWidth - canvas.width ? imgWidth - canvas.width : point[0];\r\n  }\r\n  if (imgHeight < canvas.height || point[1] < 0) {\r\n    point[1] = 0;\r\n  } else {\r\n    point[1] = point[1] > imgHeight - canvas.height ? imgHeight - canvas.height : point[1];\r\n  }\r\n  return point;\r\n}\r\n\r\n// Redraw the canvas\r\nfunction redraw(x, y, data, canvasName = \"newCanvas\") {\r\n  let canvas = document.getElementById(canvasName);\r\n  canvas.getContext(\"2d\").putImageData(data, -x, -y, x, y, canvas.width, canvas.height);\r\n}\r\n\r\n// Copy the image data from data1 into data2\r\nfunction copy(data1, data2) {\r\n  data1.forEach((pixel, index) => (data2[index] = pixel));\r\n}\r\n\r\n// Change the cursor style\r\nfunction changeCursor(sample, isPixelSample = true) {\r\n  let cursor = isPixelSample ? \"container cross\" : \"container dropper\";\r\n  document.getElementById(\"container\").className = sample ? \"container\" : cursor;\r\n}\r\n\r\nexport default imageReducer;\r\n","export const convertToPercentage = (value, total) => {\r\n  if (value === 0 && total === 0) {\r\n    return 33;\r\n  }\r\n  return Math.round((value * 100) / total);\r\n};\r\n","import { convertToPercentage } from \"utils\";\r\n\r\nconst initialState = {\r\n  cc: [\"=\", \"=\", \"=\", \"=\"],\r\n  fc: [255, 255, 255, 255],\r\n  fp: [false, false, false, false],\r\n  oc: [\"=\", \"=\", \"=\", \"=\"],\r\n  rc: [255, 255, 255, 255],\r\n  tc: [10, 10, 10, 10],\r\n  rModal: [false, false, false, false],\r\n  fModal: [false, false, false, false]\r\n};\r\n\r\nfunction replaceReducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case \"UPDATEINPUT\": {\r\n      let [name, value, index] = [action.name, action.value, action.index];\r\n      let max = 255;\r\n      if (name.startsWith(\"r\")) {\r\n        let operator = state.oc[index];\r\n        if (operator === \"*\" || operator === \"/\") {\r\n          max = 500;\r\n        }\r\n      }\r\n      if (!isNaN(value) && value >= 0 && value <= max) {\r\n        value = Number(Number(value).toFixed());\r\n        state[name.substring(0, 2)][index] = value;\r\n        return state;\r\n      }\r\n      return state;\r\n    }\r\n\r\n    case \"UPDATEOPTION\": {\r\n      let [index, option, isOperator] = [action.index, action.value, action.isOperator];\r\n      if (isOperator && state.rc[index] > 255 && option !== \"*\" && option !== \"/\") {\r\n        state.rc[index] = 255;\r\n      }\r\n      if (isOperator) {\r\n        state.oc[index] = option;\r\n      } else {\r\n        state.cc[index] = option;\r\n      }\r\n      return state;\r\n    }\r\n\r\n    case \"UPDATEPERCENTAGE\": {\r\n      const index = action.index;\r\n      state.fp[index] = !state.fp[index];\r\n      if (state.fp[index] && state.fc[index] > 100) {\r\n        state.fc[index] = 100;\r\n      }\r\n      return state;\r\n    }\r\n\r\n    case \"MODAL\": {\r\n      for (let i = 0; i < state.rModal.length; i++) {\r\n        state.rModal[i] = false;\r\n        state.fModal[i] = false;\r\n      }\r\n      if (action.index >= 0) {\r\n        action.replace ? (state.rModal[action.index] = true) : (state.fModal[action.index] = true);\r\n      }\r\n      return state;\r\n    }\r\n    case \"SAMPLECOLOUR\":\r\n      const { r, g, b, a } = action;\r\n      const total = r + g + b;\r\n\r\n      state.fc = [r, g, b, a].map((value, index) => (state.fp[index] ? convertToPercentage(value, total) : value));\r\n      return state;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport default replaceReducer;\r\n","import { combineReducers } from \"redux\";\r\nimport imageReducer from \"./imageReducer\";\r\nimport replaceReducer from \"./replaceReducer\";\r\n\r\nexport default combineReducers({\r\n  image: imageReducer,\r\n  replace: replaceReducer\r\n});\r\n","export const setImgData = (isNewCanvas, data) => dispatch => {\r\n  dispatch({ type: \"SET\", isNewCanvas, data });\r\n  return Promise.resolve();\r\n};\r\n\r\nexport const setFileName = name => ({ type: \"NAME\", name });\r\n\r\nexport const refresh = () => ({ type: \"REFRESH\" });\r\n\r\nexport const updatePixel = pixel => ({ type: \"PIXEL\", pixel });\r\n\r\nexport const switchSample = sample => ({ type: \"SAMPLE\", sample });\r\n\r\nexport const basicImgEffect = (effect, payload) => ({ type: \"BASIC\", effect, payload });\r\n\r\nexport const section = (comparisons, oldVal, percentages, operators, newVal, tolerance) => ({\r\n  type: \"SECTION\",\r\n  comparisons,\r\n  oldVal,\r\n  percentages,\r\n  operators,\r\n  newVal,\r\n  tolerance\r\n});\r\n\r\nexport const swap = copyToNew => ({ type: \"SWAP\", copyToNew });\r\n\r\nexport const zoom = (isZoomOut, isNewCanvas) => ({ type: \"ZOOM\", isZoomOut, isNewCanvas });\r\n\r\nexport const center = (canvas, pageX, pageY) => ({ type: \"CENTER\", canvas, pageX, pageY });\r\n","export const updateInput = (event, index) => ({\r\n  type: \"UPDATEINPUT\",\r\n  name: event.target.name,\r\n  value: event.target.value,\r\n  index\r\n});\r\n\r\nexport const updateOption = (index, value, isOperator) => ({ type: \"UPDATEOPTION\", index, value, isOperator });\r\n\r\nexport const updatePercentage = index => ({ type: \"UPDATEPERCENTAGE\", index });\r\n\r\nexport const replaceModal = index => ({ type: \"MODAL\", index, replace: true });\r\n\r\nexport const findModal = index => ({ type: \"MODAL\", index, replace: false });\r\n\r\nexport const sampleColour = (r, g, b, a) => ({ type: \"SAMPLECOLOUR\", r, g, b, a });\r\n","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { replaceModal, updateOption, findModal } from \"./Actions/replaceActions\";\r\n\r\nconst arrowStyle = {\r\n  position: \"absolute\",\r\n  width: \"0\",\r\n  height: \"0\",\r\n  borderLeft: \"5px solid transparent\",\r\n  borderRight: \"5px solid transparent\",\r\n  borderTop: \"10px solid rgba(255,255,255,0.8)\",\r\n  top: \"calc(-100% + 13px)\",\r\n  left: \"calc(50% - 5px)\",\r\n  animation: \"appear 0.3s linear\"\r\n};\r\n\r\nconst boxStyle = {\r\n  position: \"absolute\",\r\n  width: \"max-content\",\r\n  height: \"25px\",\r\n  padding: \"5px\",\r\n  backgroundColor: \"rgba(255,255,255,0.8)\",\r\n  top: \"calc(-100% - 22.5px)\", // half of height + padding\r\n  left: \"100%\",\r\n  borderRadius: \"5px\",\r\n  transform: \"translateX(calc(-50% - 14px))\",\r\n  animation: \"appear 0.3s linear\"\r\n};\r\n\r\nfunction Options(props) {\r\n  const dispatch = useDispatch();\r\n  const index = props.index;\r\n  const modal = props.replace ? replaceModal : findModal;\r\n\r\n  let buttons = props.options.map(option => (\r\n    <button\r\n      key={option}\r\n      type=\"button\"\r\n      className=\"findBtn\"\r\n      onClick={() => dispatch(updateOption(index, option, props.replace))}\r\n    >\r\n      {option}\r\n    </button>\r\n  ));\r\n  // Add event listener for a click to get rid of modal\r\n  window.addEventListener(\r\n    \"click\",\r\n    function click() {\r\n      window.removeEventListener(\"click\", click, false);\r\n      dispatch(modal(-1));\r\n    },\r\n    false\r\n  );\r\n  return (\r\n    <React.Fragment>\r\n      <div style={arrowStyle}></div>\r\n      <div style={boxStyle}>{buttons}</div>\r\n    </React.Fragment>\r\n  );\r\n}\r\n\r\nexport default Options;\r\n","export const colours = [\"r\", \"g\", \"b\", \"a\"];\r\nexport const fullColours = [\"red\", \"green\", \"blue\", \"alpha\"];\r\n\r\n// First character of the names of the columns in replace grid (Find, Replace, Tolerance)\r\nexport const columnInitials = [\"f\", \"r\", \"t\"];\r\n\r\nexport const comparisons = [\"=\", \">\", \">=\", \"<\", \"<=\"];\r\n\r\nexport const operators = [\"=\", \"+\", \"-\", \"*\", \"/\"];\r\n","import React from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { updateInput, updatePercentage, findModal } from \"./Actions/replaceActions\";\r\nimport Options from \"./Options\";\r\nimport { colours, fullColours, comparisons } from \"./Constants\";\r\n\r\nconst mapCompareToTitle = (compare, value, isPercentage, index) => {\r\n  const colour = fullColours[index];\r\n  const prefix = `Select only pixels that have a ${colour} value`;\r\n  const suffix = isPercentage ? \"% of the pixel's total value\" : \"\";\r\n  let middle;\r\n  switch (compare) {\r\n    case \"=\":\r\n      middle = \"that is within the tolerance range of\";\r\n      break;\r\n    case \">\":\r\n      middle = \"greater than\";\r\n      break;\r\n    case \">=\":\r\n      middle = \"greater than or equal to\";\r\n      break;\r\n    case \"<\":\r\n      middle = \"less than\";\r\n      break;\r\n    case \"<=\":\r\n      middle = \"less than or equal to\";\r\n      break;\r\n    default:\r\n      return \"\";\r\n  }\r\n  return `${prefix} ${middle} ${value}${suffix}`;\r\n};\r\n\r\nexport default function Find(props) {\r\n  const { index, isAlpha } = props;\r\n  const compare = useSelector(state => state.replace.cc[index]);\r\n  const value = useSelector(state => state.replace.fc[index]);\r\n  const isPercentage = useSelector(state => state.replace.fp[index]);\r\n  const modal = useSelector(state => state.replace.fModal[index]);\r\n  const dispatch = useDispatch();\r\n\r\n  let options = modal ? <Options options={comparisons} index={index} replace={false} /> : \"\";\r\n  return (\r\n    <span>\r\n      <span style={{ position: \"relative\" }}>\r\n        <button\r\n          type=\"button\"\r\n          title={mapCompareToTitle(compare, value, isPercentage, index)}\r\n          onClick={e => {\r\n            e.stopPropagation();\r\n            dispatch(findModal(index));\r\n          }}\r\n          className=\"findBtn\"\r\n        >\r\n          {compare}\r\n        </button>\r\n        {options}\r\n      </span>\r\n      <input type=\"text\" value={value} onChange={e => dispatch(updateInput(e, index))} name={\"fc\" + colours[index]} />\r\n      {!isAlpha && (\r\n        <button\r\n          type=\"button\"\r\n          title=\"Indicate whether the search looks at the absolute or relative value\"\r\n          className=\"findBtn\"\r\n          onClick={() => dispatch(updatePercentage(index))}\r\n        >\r\n          {isPercentage ? \"%\" : \"#\"}\r\n        </button>\r\n      )}\r\n    </span>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { replaceModal, updateInput } from \"./Actions/replaceActions\";\r\nimport Options from \"./Options\";\r\nimport { colours, fullColours, operators } from \"./Constants\";\r\n\r\nconst mapOperatorToTitle = (operator, value, index) => {\r\n  let colour = fullColours[index];\r\n  var msg = \"\";\r\n  switch (operator) {\r\n    case \"=\":\r\n      msg = `Change the ${colour} value of the selected pixels to ${value}`;\r\n      break;\r\n    case \"+\":\r\n      msg = `Increase the ${colour} value of the selected pixels by ${value}`;\r\n      break;\r\n    case \"-\":\r\n      msg = `Decrease the ${colour} value of the selected pixels by ${value}`;\r\n      break;\r\n    case \"*\":\r\n      msg = `Multiply the ${colour} value of the selected pixels by ${value / 100 + 1}`;\r\n      break;\r\n    case \"/\":\r\n      msg = `Divide the ${colour} value of the selected pixels by ${value / 100 + 1}`;\r\n      break;\r\n    default:\r\n      return \"\";\r\n  }\r\n  return msg;\r\n};\r\n\r\nfunction Replace(props) {\r\n  const index = props.index;\r\n  const operator = useSelector(state => state.replace.oc[index]);\r\n  const value = useSelector(state => state.replace.rc[index]);\r\n  const modal = useSelector(state => state.replace.rModal[index]);\r\n  const dispatch = useDispatch();\r\n\r\n  let percentage = operator === \"*\" || operator === \"/\" ? \"%\" : \"\";\r\n  let options = modal ? <Options options={operators} index={index} replace={true} /> : \"\";\r\n  // The operator button\r\n  let button = (\r\n    <span style={{ position: \"relative\" }}>\r\n      <button\r\n        type=\"button\"\r\n        title={mapOperatorToTitle(operator, value, index)}\r\n        onClick={e => {\r\n          e.stopPropagation();\r\n          dispatch(replaceModal(index));\r\n        }}\r\n        className=\"findBtn\"\r\n      >\r\n        {operator}\r\n      </button>\r\n      {options}\r\n    </span>\r\n  );\r\n\r\n  return (\r\n    <span>\r\n      {button}\r\n      <input type=\"text\" value={value} onChange={e => dispatch(updateInput(e, index))} name={\"rc\" + colours[index]} />\r\n      {percentage}\r\n    </span>\r\n  );\r\n}\r\n\r\nexport default Replace;\r\n","import React from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { updateInput } from \"./Actions/replaceActions\";\r\nimport { colours } from \"./Constants\";\r\n\r\nfunction Tolerance(props) {\r\n  const index = props.index;\r\n  const dispatch = useDispatch();\r\n  const value = useSelector(state => state.replace.tc[index]);\r\n  return <input type=\"text\" value={value} onChange={e => dispatch(updateInput(e, index))} name={\"tc\" + colours[index]} />;\r\n}\r\n\r\nexport default Tolerance;\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { store } from \"./index\";\r\nimport { switchSample, basicImgEffect, section } from \"./Actions/toolActions\";\r\nimport { updateOption, updateInput, sampleColour } from \"./Actions/replaceActions\";\r\nimport Find from \"./Find\";\r\nimport Replace from \"./Replace\";\r\nimport { colours, columnInitials } from \"./Constants\";\r\nimport Tolerance from \"./Tolerance\";\r\n\r\nclass ReplaceTool extends Component {\r\n  constructor() {\r\n    super();\r\n    this.replace = this.replace.bind(this);\r\n    this.section = this.section.bind(this);\r\n    this.navigate = this.navigate.bind(this);\r\n    this.copy = this.copy.bind(this);\r\n  }\r\n\r\n  getStateValues = () => {\r\n    const state = this.props;\r\n    const { cc: comparisons, fc: oldVal, fp: percentages, oc: operators, rc, tc: tolerance } = state;\r\n    const newVal = rc.map((value, index) =>\r\n      operators[index] === \"*\" || operators[index] === \"/\" ? value / 100 + 1 : value\r\n    );\r\n    return { comparisons, oldVal, percentages, operators, newVal, tolerance };\r\n  };\r\n\r\n  replace() {\r\n    const { comparisons, oldVal, percentages, operators, newVal, tolerance } = this.getStateValues();\r\n    this.props.basicImgEffect(\"REPLACE\", [comparisons, oldVal, percentages, operators, newVal, tolerance]);\r\n  }\r\n\r\n  section() {\r\n    const { comparisons, oldVal, percentages, operators, newVal, tolerance } = this.getStateValues();\r\n    this.props.section(comparisons, oldVal, percentages, operators, newVal, tolerance);\r\n  }\r\n\r\n  // Helps the user navigate the input boxes using arrow keys\r\n  navigate(event) {\r\n    let key = event.which;\r\n    if (key >= 37 && key <= 40) {\r\n      let parent = document.getElementById(\"replaceGrid\");\r\n      let name = event.target.name;\r\n      if (!name) {\r\n        return;\r\n      }\r\n      let row = colours.findIndex(val => val === name[2]);\r\n      let col = columnInitials.findIndex(val => val === name[0]);\r\n      if (key === 37) {\r\n        // Left\r\n        if (event.target.selectionStart !== 0) {\r\n          return;\r\n        }\r\n        col = (col + columnInitials.length - 1) % columnInitials.length;\r\n      } else if (key === 38) {\r\n        // Up\r\n        row = (row + colours.length - 1) % colours.length;\r\n      } else if (key === 39) {\r\n        // Right\r\n        if (event.target.selectionStart !== event.target.value.length) {\r\n          return;\r\n        }\r\n        col = (col + 1) % columnInitials.length;\r\n      } else {\r\n        // Down\r\n        row = (row + 1) % colours.length;\r\n      }\r\n      let newName = columnInitials[col] + \"c\" + colours[row];\r\n      parent[newName].focus();\r\n      // Set cursor position\r\n      var end = 0;\r\n      if (key === 37 || key === 39) {\r\n        end = key === 37 ? parent[newName].value.length : 0;\r\n      } else {\r\n        end = event.target.selectionStart;\r\n      }\r\n      // Use setTimeout so focus occurs first\r\n      setTimeout(() => parent[newName].setSelectionRange(end, end), 0);\r\n    }\r\n  }\r\n\r\n  copy() {\r\n    const pixel = store.getState().image.pixel;\r\n    if (pixel) {\r\n      this.props.sampleColour(pixel[0], pixel[1], pixel[2], pixel[3]);\r\n    } else {\r\n      alert(\"You must specify a pixel first. Click on the cursor icon and then click on a pixel on the canvas to do so\");\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const frt = colours.map((colour, index) => (\r\n      <React.Fragment>\r\n        <Find key={\"fc\" + colour} index={index} isAlpha={index === colours.length - 1} />\r\n        <Replace key={\"rc\" + colour} index={index} />\r\n        <Tolerance key={\"tc\" + colour} index={index} />\r\n      </React.Fragment>\r\n    ));\r\n    return (\r\n      <form id=\"replaceGrid\" className=\"replaceGrid\" onKeyDown={this.navigate} autoComplete=\"off\">\r\n        <label></label>\r\n        <span>\r\n          <label>Find</label>\r\n          <button\r\n            onClick={() => this.props.switchSample(\"PIXEL\")}\r\n            type=\"button\"\r\n            title=\"Specify a section on the canvas by clicking on a pixel within that section\"\r\n            className=\"infoTool\"\r\n          >\r\n            <i id=\"clickIcon\">&nbsp;&nbsp;&nbsp;&nbsp;</i>\r\n          </button>\r\n          <button\r\n            onClick={() => this.props.switchSample(\"COLOUR\")}\r\n            type=\"button\"\r\n            title=\"Sample a pixel's colour off one of the canvases\"\r\n            className=\"infoTool\"\r\n          >\r\n            <i id=\"dropperIcon\">&nbsp;&nbsp;&nbsp;&nbsp;</i>\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={this.copy}\r\n            title=\"Copy the selected pixel's colour to the inputs\"\r\n            className=\"infoTool\"\r\n          >\r\n            <i id=\"mouseDropperIcon\">&nbsp;&nbsp;&nbsp;&nbsp;</i>\r\n          </button>\r\n        </span>\r\n        <label>Replace</label>\r\n        <label>Tolerance</label>\r\n        <label>Red:</label>\r\n        {frt[0]}\r\n        <label>Green:</label>\r\n        {frt[1]}\r\n        <label>Blue:</label>\r\n        {frt[2]}\r\n        <label>Alpha:</label>\r\n        {frt[3]}\r\n        <div id=\"replaceBtns\">\r\n          <button type=\"button\" onClick={this.replace}>\r\n            Replace Colour\r\n          </button>\r\n          <button type=\"button\" onClick={this.section}>\r\n            Replace Section Colour\r\n          </button>\r\n        </div>\r\n      </form>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(state => ({ ...state.replace }), {\r\n  switchSample,\r\n  basicImgEffect,\r\n  section,\r\n  updateOption,\r\n  updateInput,\r\n  sampleColour\r\n})(ReplaceTool);\r\n","import React from \"react\";\r\nimport ReplaceTool from \"./ReplaceTool\";\r\nimport \"./Styles/Tools.css\";\r\n\r\nfunction Tools() {\r\n  return (\r\n    <div>\r\n      <ReplaceTool />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Tools;\r\n","import React, { PureComponent } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { basicImgEffect } from \"./Actions/toolActions\";\r\n\r\nclass Lighten extends PureComponent {\r\n  constructor() {\r\n    super();\r\n    this.state = { val: 0 };\r\n    this.handleChange = this.handleChange.bind(this);\r\n    this.handleClick = this.handleClick.bind(this);\r\n  }\r\n\r\n  handleChange(event) {\r\n    let val = event.target.value;\r\n    if (!isNaN(val) && val >= 0 && val <= 500) {\r\n      val = Number(Number(val).toFixed());\r\n      this.setState({ val });\r\n    }\r\n  }\r\n\r\n  handleClick() {\r\n    this.props.basicImgEffect(\"BRIGHT\", [this.props.multiplier(this.state.val)]);\r\n  }\r\n\r\n  render() {\r\n    let text = this.props.text || \"Lighten\";\r\n    return (\r\n      <React.Fragment>\r\n        <button onClick={this.handleClick}> {text}</button>\r\n        <input type=\"text\" value={this.state.val} onChange={this.handleChange} style={{ width: \"25px\" }} />\r\n        <label>%</label>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(() => ({}), { basicImgEffect })(Lighten);\r\n","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { basicImgEffect } from \"./Actions/toolActions\";\r\nimport Lighten from \"./Lighten\";\r\n\r\nfunction SimpleTools() {\r\n  const dispatch = useDispatch();\r\n  return (\r\n    <div style={{ display: \"grid\", gridTemplateColumns: \"1fr\", justifyItems: \"center\" }}>\r\n      <div>\r\n        <button onClick={() => dispatch(basicImgEffect(\"GRAYSCALE\"))}> Grayscale </button>\r\n        <button onClick={() => dispatch(basicImgEffect(\"NEGATIVE\"))}> Negative </button>\r\n        <Lighten multiplier={ratio => ratio / 100 + 1} />\r\n        <Lighten multiplier={ratio => 100 / (ratio + 100)} text={\"Darken\"} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default SimpleTools;\r\n","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { swap, zoom } from \"./Actions/toolActions\";\r\n\r\nfunction Upload(props) {\r\n  const dispatch = useDispatch();\r\n  return (\r\n    <div>\r\n      <input id=\"upload\" type=\"file\" onChange={props.change} hidden />\r\n      <button className=\"fileBtn\" onClick={() => document.getElementById(\"upload\").click()}>\r\n        <i id=\"uploadIcon\" title=\"Upload Image\">\r\n          &nbsp;&nbsp;&nbsp;&nbsp;\r\n        </i>\r\n      </button>\r\n      <button onClick={() => dispatch(swap(false))}>\r\n        <i id=\"leftIcon\" title=\"Copy new preview to old\">\r\n          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n        </i>\r\n      </button>\r\n      <button className=\"infoTool\" onClick={() => dispatch(zoom(false, false))}>\r\n        <i id=\"plusIcon\" title=\"Zoom in\">\r\n          &nbsp;&nbsp;&nbsp;&nbsp;\r\n        </i>\r\n      </button>\r\n      <button className=\"infoTool\" onClick={() => dispatch(zoom(true, false))}>\r\n        <i id=\"minusIcon\" title=\"Zoom out\">\r\n          &nbsp;&nbsp;&nbsp;&nbsp;\r\n        </i>\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Upload;\r\n","import React, { useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { swap, zoom } from \"./Actions/toolActions\";\r\nimport Menu from \"@material-ui/core/Menu\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\n\r\nfunction Download(props) {\r\n  const dispatch = useDispatch();\r\n  const [anchor, setAnchor] = useState(null);\r\n\r\n  const handleClose = () => setAnchor(null);\r\n\r\n  const handleDownload = type => () => {\r\n    handleClose();\r\n    props.download(type);\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <button className=\"fileBtn\" onClick={e => setAnchor(e.currentTarget)}>\r\n        <i id=\"downloadIcon\" title=\"Download Image\">\r\n          &nbsp;&nbsp;&nbsp;&nbsp;\r\n        </i>\r\n      </button>\r\n      <button onClick={() => dispatch(swap(true))}>\r\n        <i id=\"rightIcon\" title=\"Copy old preview to new\">\r\n          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n        </i>\r\n      </button>\r\n      <button className=\"infoTool\" onClick={() => dispatch(zoom(false, true))}>\r\n        <i id=\"plusIcon\" title=\"Zoom in\">\r\n          &nbsp;&nbsp;&nbsp;&nbsp;\r\n        </i>\r\n      </button>\r\n      <button className=\"infoTool\" onClick={() => dispatch(zoom(true, true))}>\r\n        <i id=\"minusIcon\" title=\"Zoom out\">\r\n          &nbsp;&nbsp;&nbsp;&nbsp;\r\n        </i>\r\n      </button>\r\n      <Menu anchorEl={anchor} keepMounted open={Boolean(anchor)} onClose={handleClose}>\r\n        <MenuItem onClick={handleDownload(\"png\")}>PNG</MenuItem>\r\n        <MenuItem onClick={handleDownload(\"jpeg\")}>JPG</MenuItem>\r\n        <MenuItem onClick={handleDownload(\"webp\")}>WebP</MenuItem>\r\n      </Menu>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Download;\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  setImgData,\r\n  setFileName,\r\n  refresh,\r\n  center,\r\n  updatePixel,\r\n  basicImgEffect,\r\n  swap,\r\n  switchSample\r\n} from \"./Actions/toolActions\";\r\nimport { sampleColour } from \"./Actions/replaceActions\";\r\nimport Tools from \"./Tools\";\r\nimport SimpleTools from \"./SimpleTools\";\r\nimport \"./Styles/App.css\";\r\nimport Upload from \"./Upload\";\r\nimport Download from \"./Download\";\r\n\r\nclass App extends Component {\r\n  constructor() {\r\n    super();\r\n    this.imageChange = this.imageChange.bind(this);\r\n    this.download = this.download.bind(this);\r\n    this.recenter = this.recenter.bind(this);\r\n    this.handleClick = this.handleClick.bind(this);\r\n  }\r\n\r\n  // Fires when a new image is uploaded\r\n  imageChange(event) {\r\n    const file = event.target.files[0];\r\n    if (file) {\r\n      let img = new Image();\r\n      const reader = new FileReader();\r\n      reader.onload = read => {\r\n        img.onload = imgEvent => {\r\n          // Get image data\r\n          var canvas = document.createElement(\"canvas\");\r\n          let img = imgEvent.target;\r\n          let width = img.width;\r\n          let height = img.height;\r\n          canvas.width = width;\r\n          canvas.height = height;\r\n          canvas.getContext(\"2d\").drawImage(img, 0, 0, width, height);\r\n          let imgData = canvas.getContext(\"2d\").getImageData(0, 0, width, height);\r\n\r\n          // Draw image onto canvases\r\n          canvas = document.getElementById(\"canvas\");\r\n          canvas.width = canvas.scrollWidth;\r\n          canvas.height = canvas.scrollHeight;\r\n          const ctx = canvas.getContext(\"2d\");\r\n          canvas = document.getElementById(\"newCanvas\");\r\n          canvas.width = canvas.scrollWidth;\r\n          canvas.height = canvas.scrollHeight;\r\n          this.props.setImgData(false, imgData).then(() => {\r\n            ctx.putImageData(this.props.imgData, 0, 0, 0, 0, canvas.scrollWidth, canvas.scrollHeight);\r\n            // copy image data into other canvas\r\n            this.props.swap(true);\r\n          });\r\n\r\n          // refresh state\r\n          this.props.refresh();\r\n        };\r\n\r\n        let filedata = read.target.result;\r\n        if (filedata.startsWith(\"data:image\")) {\r\n          img.src = filedata;\r\n          this.props.setFileName(file.name.substring(0, file.name.lastIndexOf(\".\")));\r\n        } else {\r\n          alert(\"That file type is not supported\");\r\n        }\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n    // Prevent file name from appearing\r\n    //let name = event.target.value.substr(event.target.value.lastIndexOf(\"\\\\\") + 1);\r\n    event.target.value = \"\";\r\n  }\r\n\r\n  // Download new image\r\n  download(type) {\r\n    if (this.props.imgData) {\r\n      const link = document.createElement(\"a\");\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = this.props.imgData.width;\r\n      canvas.height = this.props.imgData.height;\r\n      const ctx = canvas.getContext(\"2d\");\r\n      ctx.putImageData(this.props.newData, 0, 0);\r\n      link.setAttribute(\"href\", canvas.toDataURL(`image/${type}`));\r\n      link.setAttribute(\"download\", `${this.props.fileName}-converted`);\r\n      link.click();\r\n      link.remove();\r\n      canvas.remove();\r\n    }\r\n  }\r\n\r\n  // Center the image on canvas to the clicked point\r\n  recenter(event) {\r\n    let canvas = event.target;\r\n    if (this.props.imgData && (this.props.imgData.width > canvas.width || this.props.imgData.height > canvas.height)) {\r\n      this.props.center(canvas, event.pageX, event.pageY);\r\n    }\r\n  }\r\n\r\n  handleClick(event) {\r\n    if (this.props.imgData && (this.props.pixelSample || this.props.colourSample)) {\r\n      let canvas = event.target;\r\n      let [ratioX, ratioY] = [canvas.width / canvas.scrollWidth, canvas.height / canvas.scrollHeight];\r\n      let point = [\r\n        Math.round((event.pageX - canvas.offsetLeft) * ratioX + this.props.x1),\r\n        Math.round((event.pageY - canvas.offsetTop) * ratioY + this.props.y1)\r\n      ];\r\n      if (point[0] >= 0 && point[0] <= this.props.imgData.width && point[1] >= 0 && point[1] <= this.props.imgData.height) {\r\n        let r = this.props.imgData.data[point[1] * this.props.imgData.width * 4 + point[0] * 4];\r\n        let g = this.props.imgData.data[point[1] * this.props.imgData.width * 4 + point[0] * 4 + 1];\r\n        let b = this.props.imgData.data[point[1] * this.props.imgData.width * 4 + point[0] * 4 + 2];\r\n        let a = this.props.imgData.data[point[1] * this.props.imgData.width * 4 + point[0] * 4 + 3];\r\n        if (this.props.pixelSample) {\r\n          let pixel = [r, g, b, a, point[0], point[1]];\r\n          this.props.updatePixel(pixel);\r\n        } else {\r\n          this.props.sampleColour(r, g, b, a);\r\n        }\r\n      }\r\n    } else if (this.props.pixelSample) {\r\n      this.props.switchSample(\"PIXEL\");\r\n      alert(\"You must upload an image first. Click the upload button to upload an image.\");\r\n    } else {\r\n      this.recenter(event);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"container\" id={\"container\"}>\r\n        <div className=\"grid\">\r\n          <label>Old Preview</label>\r\n          <label>New Preview</label>\r\n\r\n          <div className=\"transparent\">\r\n            <canvas id=\"canvas\" onClick={this.handleClick}></canvas>\r\n          </div>\r\n          <div className=\"transparent\">\r\n            <canvas id=\"newCanvas\" onClick={this.handleClick}></canvas>\r\n          </div>\r\n\r\n          <Upload change={this.imageChange} />\r\n          <Download download={this.download} />\r\n        </div>\r\n\r\n        <Tools />\r\n        <SimpleTools />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // No need to rerender since the canvas rerenders on its own\r\n  shouldComponentUpdate() {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default connect(state => ({ ...state.image }), {\r\n  setImgData,\r\n  setFileName,\r\n  refresh,\r\n  center,\r\n  updatePixel,\r\n  basicImgEffect,\r\n  swap,\r\n  switchSample,\r\n  sampleColour\r\n})(App);\r\n/** TODO:\r\n * Switch to MUI\r\n * Replace relative values (swap red with blue)\r\n */\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { Provider } from \"react-redux\";\r\nimport { createStore, applyMiddleware } from \"redux\";\r\nimport thunk from \"redux-thunk\";\r\nimport rootReducer from \"./Reducers/rootReducer\";\r\nimport App from \"./App\";\r\n\r\nexport const store = createStore(rootReducer, {}, applyMiddleware(thunk));\r\n\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <App />\r\n  </Provider>,\r\n  document.getElementById(\"root\")\r\n);\r\n"],"sourceRoot":""}